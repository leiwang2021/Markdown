# 数据库系统概论

## 第一章　绪论

### 1.1 数据库系统概述

- 数据库的4个基本概念
  - 数据
  - 数据库(DataBase, DB), 长期存储在计算机内，有组织的、可共享的大量数据的集合
  - 数据库管理系统(DBMS)
    - 数据库管理系统是位于用户与操作系统之间的一层数据管理软件
    - 提供数据定义语言(DDL)
    - 数据组织、存储和管理
    - 提供数据操纵语言(DML)
  - 数据库系统(DBS)
    - 由数据库、数据库管理系统、应用程序和数据库管理员组成的
- 数据管理技术的产生和发展
  - 人工管理阶段
  - 文件系统阶段
  - 数据库系统阶段
- 数据库系统的特点
  - 使用文件系统时，要关注记录的结构和不同文件中记录之间的联系，而数据库系统提供可功能强大的操作
  - 数据结构化，不仅数据内部是结构化的，而且整体数据是结构化的，数据之间是具有联系的
  - 数据的共享性高、冗余度低且易扩充
  - 数据独立性高，数据与程序的独立
  - 数据由数据库管理系统统一管理和控制

### 1.2 数据模型

- 数据模型是数据库系统的核心和基础
- 两类数据模型
  - 概念模型，按用户的观点来对数据和信息建模　
  - 逻辑模型和物理模型，按计算机系统的观点对数据建模，主要用于数据库管理系统的实现
- 概念模型
  - 实体
  - 属性
  - 唯一标识实体的属性集称为码
  - 实体型
  - 实体集
  - 联系
  - 实体-联系方法，该方法用E-R图来描述现实世界的概念模型
- 数据模型的组成要素
  - 数据结构
  - 数据操作
  - 数据的完整性约束条件
- 常用的逻辑数据模型
  - 层次模型
    - IMS
    - 层次模型的数据结构，用树形结构来表示各类实体以及实体间的联系
    - 优缺点
  - 网状模型
    - CODASYL系统
    - 允许一个以上的结点无双亲，一个结点可以有多于一个的双亲
  - 关系模型
    - 一个关系通常对应一张表
    - 一行为元组
    - 属性，一列
    - 码，某个属性组，可以唯一确定一个元组
    - 域
    - 分量，元组中的一个属性值
    - 关系模式，关系的每一个分量必须是一个不可分的数据项，不允许表中还有表
  - 面向对象数据模型
  - 对象关系数据模型
  - 半结构化数据模型
  - 非结构化数据模型

### 1.3 数据库系统的结构

- 数据库系统模式的概念
- 数据库系统的三级模式结构
  - 模式，也称逻辑模式，模式数据定义语言(模式DDL)来定义模式
  - 外模式，是与某一应用有关的数据的逻辑表示，通常是模式的子集(外模式DDL)
  - 内模式，是数据物理结构和存储方式的描述
- 数据库的二级映像功能与数据独立性
  - 外模式/模式映像
  - 模式/内模式映像

### 1.4 数据库系统的组成

- 应用程序员在外模式下

## 第2章　关系数据库

### 2.1 关系数据结构及形式化定义

- 关系
  - 域
  - 笛卡尔积
  - 关系，关系中的每个元素是关系中的元组
  - 候选码
  - 主码
  - 全码
  - 关系可以有三种类型: 基本关系、查询表和视图表
- 关系模式
  - 关系是关系模式在某一时刻的状态或内容，关系模式是静态的、稳定的，而关系是动态的

### 2.2 关系操作

- 基本的关系操作
  - 查询、插入、删除、修改
  - 查询操作分为: **选择、投影**、连接、除、**并、差**、交、**笛卡尔积**
  - 操作的对象和结果都是集合
- 关系数据语言的分类
  - 关系代数和关系演算
  - 结构化查询语言(SQL) 是查询、数据定义语言、数据操纵语言和数据控制语言的集合。是关系数据库的标准语言

### 2.3 关系的完整性

- 实体完整性
  - 主属性不能取空值
- 参照完整性
  - 外码只能取空值或被参照关系的主码值
- 用户定义完整性

### 2.4 关系代数

- 抽象的查询语言
- 传统的集合运算
  - 并
  - 差
  - 交
  - 笛卡尔积
- 专门的关系运算
  - 选择
  - 投影: 从R中选出若干属性组成新的关系
  - 连接:
    - 等值连接
    - 自然连接
    - 非等值连接
    - 外连接: 把悬浮元组也保存在结果关系中，而在其他属性上填空值
    - 左外连接:只保留左边关系中的悬浮元组
    - 右外连接: 只保留右边关系的悬浮元组
  - 除运算
- 关系代数中，这些运算经有限次复合后形成的表达式称为关系代数表达式

### 2.5 关系演算

- 元组关系演算语言ALPHA
- 域关系演算语言QBE

## 第3章　关系数据库标准语言SQL

### 3.1 SQL概述

- SQL的特点
  - 综合统一，集数据查询、操纵、定义和控制于一体
  - 高度非过程化
  - 面向集合的操纵方式
  - 以同一种语法结构提供多种使用方式，SQL能够嵌入到高级语言程序中(c++ java)
  - SQL的动词
    - 数据查询　SELECT
    - 数据定义　CREATE DROP ALTER
    - 数据操纵　INSERT UPDATE DELETE
    - 数据控制　GRANT REVOKE
- SQL的基本概念
  - 一个关系就对应一个基本表
  - 视图是从一个或几个基本表导出的表，是一个虚表

### 3.3 数据定义

- 一个关系数据库管理系统的实例中可以建立多个数据库，一个数据库中可以建立多个模式，一个模式下通常包括多个表、视图和索引等数据库对象
- 模式的定义和删除
  - CREATE SCHEMA <模式名> AUTHORIZATION<用户名>
  - 定义模式实际上定义了一个命名空间
  - DROP SCHEMA <模式名> <CASCADE | RESTRICT> 删除模式
- 基本表的定义、删除与修改
  - CREATE TABLE<表名>(...)
  - 数据类型
  - 模式与表
    - 搜索路径　SHOW search_path
    - 设置搜索路径　SET search_path TO "S-T", PUBLIC
  - 修改基本表　ALTER TABLE <表名>
  - 删除基本表　DROP TABLE <表名> 
- 索引的建立与删除
  - 顺序文件上的索引、B+树索引、散列索引、位图索引
  - 建立索引　CREATE INDEX
  - 修改索引　ALTER  INDEX
  - 删除索引　DROP INDEX

### 3.4 数据查询

- SELECT语句
- 单表查询
  - 选择表中的若干列　SELECT Sno,Sname FROM Student;
    - SELECT子句的<目标列表达式>不仅可以是表中的属性列，也可以是表达式
    - 可以通过指定别名来改变查询结果的列标题
  - 选择表中的若干元组
    - 指定DISTINCT去掉结果表中的重复行
    - WHERE子句，比较大小，确定范围，确定集合，字符匹配，涉及空值的查询，多重条件查询
  - ORDER BY子句
  - 聚集函数
    - COUNT       SELECT COUNT(*) FROM Student;
    - SUM
    - AVG
    - MAX
    - MIN
    - 当聚集函数遇到空值时，除COUNT(*)外，都跳过空值只处理非空值
    - 聚集函数只能用于SELECT子句和GROUP BY 中的HAVING子句
  - GROUP BY子句
    - 分组后聚集函数将作用于每一个组
    - SELECT Cno, COUNT(Sno) FROM SC GROUP BY Cno;
    - 可以使用HAVING短语指定筛选条件，HAVING短语作用于组
- 连接查询
  - 等值与非等值连接查询
  - 自身连接: 一个表与其自己进行连接
  - 外连接
  - 多表连接
- 嵌套查询
  - 将一个查询块嵌套在另一个查询块的WHERE子句或HAVING短语，以层层嵌套的方式来构造程序正是SQL中结构化的含义所在
  - 带有IN谓词的子查询
  - 相关子查询
  - 不相关子查询
  - 带有ANY(SOME)或ALL谓词的子查询
  - 带有EXISTS谓词的子查询，不返回任何数据，只产生true或false
- 集合查询 
  - UNION　并
  - INTERSECT 交
  - EXCEPT 差
- 基于派生表的查询
  - 子查询出现在FROM子句中，这时子查询生成的临时派生表

### 3.5 数据更新

- 插入语句
  - 插入元组　INSERT INTO Student(Sno,Sname) VALUES('201521234','zhangchengming');
  - 插入子查询结果
- 修改语句
  - 修改某一个元组的值　　UPDATE Student SET Sage=22 WHERE Sno='201215121';
  - 修改多个元组的值　　UPDATE Student SET Sage=Sage+1;
  - 带子查询的更新语句
- 删除数据
  - 删除某一个元组的值　DELETE FROM Student WHERE Sno='201231332'
  - 删除多个元组的值　　DELETE FROM SC;
  - 带子查询的删除语句　

### 3.6 空值的处理

- 空值的产生
- 空值的判断
- 空值的约束条件　
  - 属性定义中有NOT NULL约束条件的不能取空值，加了UNIQUE限制的，码属性等都不能取空值
- 空值的算术运算、比较运算和逻辑运算
  - 三值逻辑　True False Unknown

### 3.7 视图

- 定义视图
  - 建立视图　CREATE VIEW IS_Student AS SELECT Sno,Sname,Sage FROM Student WHERE Sdept='S'
    - WITH CHECK OPTION
    - 行列子集视图
    - 视图中的数据并不实际存储，带虚拟列的视图也称为带表达式的视图
  - 删除视图　DROP VIEW
- 查询视图
- 更新视图
  - 对视图的更新操作通过视图消解，转换为对基本表的更新操作
- 视图的作用