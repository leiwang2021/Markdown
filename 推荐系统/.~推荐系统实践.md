# 推荐系统实践

- 序：大多数论文都把推荐系统看成评分预测问题，实际中最常用的是TopN推荐
- 前言：
  - 按照数据分成：协同过滤、内容过滤、社会化过滤
  - 按照算法分成：基于邻域的算法、基于图的算法、基于矩阵分解、基于概率模型的算法

## 第一章　好的推荐系统

### １.1　什么是推荐系统

- 推荐系统的基本任务是联系用户和物品，解决信息过载的问题
- 推荐系统通过分析用户的历史行为给用户的兴趣建模，从而主动给用户推荐能够满足兴趣和需求的信息
- 长尾商品：不热门的商品，推荐系统通过发掘用户的行为，找到用户的个性化需求，从而将长尾商品准确地推荐给需要它的用户，帮助用户发现感兴趣但很难发现的商品
- 社会化推荐：让好友给自己推荐物品
- 基于内容的推荐
- 基于协同过滤的推荐

### 1.2　个性化推荐系统的应用

- 推荐系统应用：前台的展示页面、后台的日志系统、推荐算法系统
- 电子商务、电影和视频网站、音乐、社交网络、个性化阅读、基于位置的服务、个性化邮件、个性化广告（定向投放）

### 1.3　推荐系统评测

- 推荐系统的参与者：用户、内容提供方、网站

- 好的推荐系统不仅仅能准确预测用户的行为、而且能够拓展用户的视野、帮助用户发现他们可能感兴趣，但却不容易发现的东西，同时能帮助商家介绍长尾商品

- 三种评测推荐系统效果的实验方法：
  - 离线实验：在日志系统上完成，无法获得很多商业上的指标
  - 用户调查：用户调查需要有一些真实用户、让它们在需要测试的推荐系统上完成一些任务，代价大
  - 在线实验：在完成离线实验和用户调查后，将推荐系统上线做AB测试，将它和旧算法进行比较，对不同组的用户采用不同的算法，周期长

- 推荐系统的上线：
  - 首先，通过离线实验证明它在离线指标上优于现有的算法
  - 通过用户调查确定它的用户满意度不低于现有的算法
  - 通过在线的AB测试确定它在关心的指标上优于现有的算法

- 评测指标：

  - 用户满意度：只能通过用户调查和在线实验获得，可以利用购买率、点击率、用户停留时间和转化率等指标度量用户的满意度

  - 预测准确度，可以通过离线实验计算

    - 评分预测：预测用户对物品评分的行为，RMSE和MAE两种计算方式：

      RMS加大了对预测不准的用户物品评分的惩罚。若评分系统是基于整数的，对预测结果取整会降低MAE的误差

    - TopN推荐：给用户一个个性化的推荐列表，一般通过准确率(precision)/召回率(recall)度量，为了全面评测TopN推荐的准确率和召回率，一般会选取不同的推荐列表长度N，计算出一组准确率/召回率

    - 关于评分预测和TopN推荐的讨论

  - 覆盖率：描述一个推荐系统对物品长尾的发掘能力，推荐系统能够推荐出来的物品占总物品集合的比例，可以通过研究物品在推荐列表中出现次数的分布描述推荐系统发掘长尾的能力。信息熵，基尼指数可以定义覆盖率。 马太效应：强者更强，弱者更弱。

    - 评测推荐系统是否有马太效应：利用基尼指数。如果G1是从初始用户行为中计算出的物品流行度的基尼指数，G2是从推荐列表计算出的物品流行度的基尼指数，若G1>G2，则具有马太效应

  - 多样性：描述了推荐列表中物品两两不相似度，由于用户的兴趣是广泛的

  - 新颖性：利用推荐结果的平均流行度，如果推荐结果中物品的平均热门程度较低，那么推荐结果可能有较高的新颖性

  - 惊喜度：和用户历史上喜欢的物品不相似，但用户却觉得满意的推荐

  - 信任度：度量推荐系统的信任度只能通过问卷调查的方式

  - 实时性：实时更新推荐列表，将新加入的物品推荐给用户(冷启动)

  - 健壮性：主要利用模拟攻击评测

  - 商业目标：

  - 总结：对于可以离线优化的指标，应该在给定覆盖率、多样性、新颖性等限制条件下，尽量优化预测准确度

- 评测维度

  - 用户维度
  - 物品维度
  - 时间维度

## 第二章 利用用户行为数据

- 基于用户行为分析的推荐算法是个性化推荐系统的重要算法，称为协同过滤算法

### 2.1 用户行为数据简介

- 显性反馈行为：用户明确表示对物品喜好的行为
- 隐性反馈行为：不能明确代表用户喜好的行为，如页面浏览
- context:产生行为的上下文，包括时间和地点等

### 2.2 用户行为分析

- 用户活跃度(用户产生过行为的物品总数)和物品流行度(对物品产生过行为的用户总数)的分布，都满足长尾分布
- 用户活跃度和物品流行度的关系：用户越活跃，越倾向于浏览冷门的物品
- 仅仅基于用户行为数据设计的推荐算法一般称为协同过滤算法：
  - 基于邻域的算法
    - 基于用户的协同过滤算法：给用户推荐和他兴趣相似的其他用户喜欢的物品
    - 基于物品的协同过滤算法：给用户推荐和他之前喜欢的物品相似的物品
  - 隐语义模型(LFM)
  - 基于图的随机游走算法

### 2.3 实验设计和算法评测

### 2.4 基于邻域的算法

- 基于用户的协同过滤算法
  - 基础算法
    - （1）找到和目标用户兴趣相似的用户集合  （2）找到这个集合中的用户喜欢的，且没听说的
    - 主要利用行为相似度计算兴趣的相似度：  采用Jaccard公式或余弦相似度计算
    - 建立物品到用户的倒排表，求出用户集合（u,v）不为0的，最后求出用户相似度矩阵
    - UserCF算法会给用户推荐和他兴趣最相似的K个用户喜欢的物品
    - 参数K是UserCF的一个重要参数
  - 用户相似度计算的改进
    - 惩罚共同兴趣列表中热门物品对他们相似度的影响
- 基于物品的协同过滤算法
  - 目前业界应用最多的算法    ItemCF
  - 基础算法
    - 主要通过分析用户的行为记录计算物品之间的相似度
    - （1）计算物品之间的相似度  （2）根据物品的相似度和用户的历史行为给用户生成推荐列表
    - 建立用户-物品倒排表，对每个用户，将他物品列表中的物品两两在共现矩阵C中加1
    - 得到物品之间的相似度后，计算用户u对一个物品j的兴趣
  - 用户活跃度对物品相似度的影响
    - 活跃用户对物品的相似度的贡献应该小于不活跃的用户
  - 物品相似度的归一化
    - 如果将ItemCF的相似度矩阵按最大值归一化
    - 相似度的归一化可以提高推荐的多样性

- UserCF和ItemCF的综合比较
  - 新闻领域：UserCF更适合，UserCF更加社会化
  - 图书、电子商务、电影网站：ItemCF更适合，ItemCF的推荐更加个性化
  - 哈利波特问题：在ItemCF中热门物品和其他物品的相似度很高

### 2.5 隐语义模型

LFM(latent fator model), 最早在文本挖掘领域被提出，找到文本的隐含语义

- 基础算法
  - 核心思想是通过隐含特征联系用户兴趣和物品
  - 对书和物品的兴趣进行分类，对于某个用户，首先得到它的兴趣分类，然后从分类中挑选它可能喜欢的物品
    - 如何给物品分类？
    - 如何确定用户对哪些类的物品感兴趣？
    - 如何确定物品在一个类中的权重？
  - 隐含语义分析（latent variable analysis）采取基于用户行为统计的自动聚类
  - 隐含语义分析技术相关：pLSA,LDA,隐含类别模型（latent class model)，隐含主题模型(latent topic model),矩阵分解（matrix factorization）
  - 显性反馈数据集。有评分
  - 隐性反馈数据集，只有正样本（用户喜欢什么物品）
    - 在隐性反馈数据集上应用LFM解决TopN问题首先需要给每个用户生成负样本
    - 对每个用户，正负样本的平衡
    - 对每个用户，要采取热门用户却没有行为的物品作为负样本
  - 正负样本比例对推荐结果性能影响最大
  - 计算用户u对物品i的兴趣：  P^TQ
  - LFM不能实时化
- LFM与基于邻域算法的比较
  - LFM是一种学习方法，优化一个特定指标。而基于邻域的基于统计的方法
  - 节省内存，存储空间是O(F*(M+N))
  - 时间复杂度
  - LFM不能进行在线实时推荐

### 2.3 基于图的模型

- 用户行为数据的二分图表示（偶图）

- 基于图的推荐算法

  - 度量两个顶点之间的相关性

  - 基于随机游走的PersonalRank算法

    - 根据概率决定是否继续游走

    - 经过多次随机游走后，每个物品被访问到的概率会收敛到一个数，最终的推荐列表中物品的权重就是物品节点的访问概率

    - 由于时间复杂度高，采用两种解决办法：

      （1）减少迭代次数

         (2）转化为矩阵的形式求解

